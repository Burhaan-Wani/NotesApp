<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>InkScribe</title>
        {% load static %}
        <link rel="stylesheet" href="{% static 'css/forgotPage.css' %}" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
            integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
    </head>
    <body>
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div
                    class="col-11 col-sm-10 col-md-7 col-lg-6 col-xl-5 text-center p-0 mt-3"
                >
                    <div
                        class="card shadow_card_box px-xl-4 px-3 pt-3 pb-0 mt-5 mb-0"
                    >
                        <h2 id="heading">Forgot Your Password?</h2>
                        <p>Fill all form fields to reset your password</p>
                        <form id="msform" class="msform2" method="post">
                            {% csrf_token %}
                            <!-- progressbar -->
                            <ul id="progressbar">
                                <li class="active" id="account">
                                    <strong>Account</strong>
                                </li>
                                <li id="personal"><strong>OTP</strong></li>
                                <li id="payment"><strong>Reset</strong></li>
                                <li id="confirm"><strong>Finish</strong></li>
                            </ul>
                            <div class="progress">
                                <div
                                    class="progress-bar progress-bar-striped progress-bar-animated"
                                    role="progressbar"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                                ></div>
                            </div>
                            <br />
                            <!-- fieldsets -->
                            <fieldset class="fieldset4">
                                <div class="form-card">
                                    <div class="row">
                                        <div class="col-7">
                                            <h2 class="fs-title">
                                                Email Verification:
                                            </h2>
                                        </div>
                                        <div class="col-5">
                                            <h2 class="steps">Step 1 - 4</h2>
                                        </div>
                                    </div>
                                    <label class="fieldlabels">Email: *</label>
                                    <input
                                        type="email"
                                        name="email"
                                        placeholder="Email Id"
                                    />
                                    <div>
                                        <small
                                            id="er5"
                                            class="text-danger m-0 p-0"
                                        ></small>
                                    </div>
                                </div>
                                <input
                                    type="submit"
                                    class="action-button search"
                                    value="Search"
                                />
                            </fieldset>
                            <fieldset class="fieldset5">
                                <div class="form-card">
                                    <div class="row">
                                        <div class="col-7">
                                            <h2 class="fs-title">
                                                OTP Verification:
                                            </h2>
                                        </div>
                                        <div class="col-5">
                                            <h2 class="steps">Step 2 - 4</h2>
                                        </div>
                                    </div>
                                    <label class="fieldlabels">OTP: *</label>
                                    <div class="input-group">
                                        <input
                                            class="mb-1"
                                            style="width: 75%"
                                            id="otp-input"
                                            type="text"
                                            name="resetOtp"
                                            placeholder="1234"
                                            min="4"
                                            max="4"
                                        />
                                        <input
                                            style="width: 25%"
                                            type="button"
                                            id="otp-button"
                                            value="Send OTP"
                                            class="otpSend mb-1"
                                        />
                                        <div class="d-block">
                                            <small class="text-muted"
                                                >Wait 3 to 4 seconds when
                                                clicking 'send OTP'</small
                                            >
                                        </div>
                                    </div>
                                    <div>
                                        <small
                                            id="er6"
                                            class="text-danger m-0 p-0"
                                        ></small>
                                    </div>
                                </div>
                                <input
                                    type="submit"
                                    class="action-button"
                                    value="Next"
                                />
                                <!-- <input
                  type="button"
                  name="previous"
                  class="previous1 action-button-previous"
                  value="Previous"
                /> -->
                            </fieldset>
                            <fieldset class="fieldset6">
                                <div class="form-card">
                                    <div class="row">
                                        <div class="col-7">
                                            <h2 class="fs-title">
                                                Reset Password:
                                            </h2>
                                        </div>
                                        <div class="col-5">
                                            <h2 class="steps">Step 3 - 4</h2>
                                        </div>
                                    </div>
                                    <label class="fieldlabels"
                                        >New Password:</label
                                    >
                                    <input
                                        type="password"
                                        name="newPassword"
                                        placeholder="Enter New Password"
                                    />
                                    <label class="fieldlabels"
                                        >Confirm New Password:</label
                                    >
                                    <input
                                        type="password"
                                        name="confirmNewPassword"
                                        placeholder="Re-Enter New Password"
                                    />
                                    <div>
                                        <small
                                            id="er8"
                                            class="text-danger m-0 p-0"
                                        ></small>
                                    </div>
                                </div>
                                <input
                                    type="submit"
                                    class="action-button"
                                    value="Submit"
                                />
                                <!-- <input
                  type="button"
                  name="previous"
                  class="previous2 action-button-previous"
                  value="Previous"
                /> -->
                            </fieldset>
                            <fieldset class="fieldset8">
                                <div class="form-card">
                                    <div class="row">
                                        <div class="col-7">
                                            <h2 class="fs-title">Finish:</h2>
                                        </div>
                                        <div class="col-5">
                                            <h2 class="steps">Step 4 - 4</h2>
                                        </div>
                                    </div>
                                    <br /><br />
                                    <h2 class="purple-text text-center">
                                        <strong>SUCCESS !</strong>
                                    </h2>
                                    <br />
                                    <div class="row justify-content-center">
                                        <div class="col-3">
                                            <img
                                                src="https://i.imgur.com/GwStPmg.png"
                                                class="fit-image"
                                            />
                                        </div>
                                    </div>
                                    <br /><br />
                                    <div class="row justify-content-center">
                                        <div class="col-7 text-center">
                                            <h5 class="purple-text text-center">
                                                You Have Successfully Signed Up
                                            </h5>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="{% static 'js/forgotPage.js' %}"></script>
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
        <script>
            $(".msform2").submit(function (e) {
                e.preventDefault();
                $.ajax({
                    data: $(".msform2").serialize(),
                    type: "POST", // GET or POST
                    url: "/identify/", // the file to call
                    success: function (response) {
                        if (response == "Email found.") {
                            $("#er5").text(response);
                            setTimeout(() => {
                                $(".fieldset4").removeClass("d-block");
                                $(".fieldset4").addClass("d-none");
                                $(".fieldset5").removeClass("d-none");
                                $(".fieldset5").addClass("d-block");
                                $(".progress-bar").css("width", "50%");
                                $("#personal").addClass("active");
                            }, 1000);
                        } else if (
                            response ==
                            "Couldn't find such email, check your email once again."
                        ) {
                            $("#er5").text(response);
                        } else if (response == "Field can't be left blank.") {
                            $("#er5").text(response);
                        } else if (response == "match") {
                            $("#er6").text("");
                            setTimeout(() => {
                                $(".fieldset5").removeClass("d-block");
                                $(".fieldset5").addClass("d-none");
                                $(".fieldset6").removeClass("d-none");
                                $(".fieldset6").addClass("d-block");
                                $(".progress-bar").css("width", "75%");
                                $("#payment").addClass("active");
                            }, 1000);
                        } else if (response == "incorrect OTP") {
                            $("#er6").text(response);
                        } else if (response == "Field's can't be left blank.") {
                            $("#er8").text(response);
                        } else if (
                            response ==
                            "New Password and Confirm New Password do not match."
                        ) {
                            $("#er8").text(response);
                        } else if (
                            response ==
                            "Minimum 8+ chars, atleast 1 Uppercase, 1 Lowercase, 1 Number, and 1 special Chars."
                        ) {
                            $("#er8").text(response);
                        } else if (response == "next") {
                            $("#er8").text("");
                            $(".fieldset6").removeClass("d-block");
                            $(".fieldset6").addClass("d-none");
                            $(".fieldset8").addClass("d-block");
                            $(".progress-bar").css("width", "100%");
                            $("#confirm").addClass("active");
                            setTimeout(() => {
                                window.location.href = "/login";
                            }, 1000);
                        }
                    },
                });
            });
        </script>

        <script>
            $("#otp-button").on("click", function () {
                $.ajax({
                    type: "GET", // GET or POST
                    url: "/resetotp/", // the file to call
                    success: function (response) {
                        if (response == "OTP has been sent, check your mail.") {
                            $("#er6").text(response);
                        }
                    },
                });
            });
        </script>
    </body>
</html>
